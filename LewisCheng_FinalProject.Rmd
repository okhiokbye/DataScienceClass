---
title: "LewisCheng_FinalProject"
author: "Lewis Cheng"
date: "`r Sys.Date()`"
output: html_document
---

```{R}
library(tidyverse)
airData <- read_csv("smallSurveyWithComments.csv")
```
#histogram of age, most people traveling around 30s-40s, plus spike at 18 (prob college)
```{r}
hist(airData$Age)
```
#histogram of price sensitivity, seems to be not too sensitive
```{r}
hist(airData$Price.Sensitivity)
```
#histogram of year of first flight: seems to be pretty distributed, except for a spike around 2003
```{r}
hist(airData$Year.of.First.Flight)
```
#histogram of flights per year: very normal distribution centered around 1
```{r}
hist(airData$Flights.Per.Year)
```
#histogram of loyalty: most customers are not that loyal, but those who do stick with their airline
```{r}
hist(airData$Loyalty)
```
#histogram of most people either dont have it or have 1
```{r}
hist(airData$Total.Freq.Flyer.Accts)
```
#histogram of shopping amounts: most people dont spend that much at the airport, but some are splurgers
```{r}
hist(airData$Shopping.Amount.at.Airport)
```
#histogram of eating/drinking at airport: most people grab a bite 
```{r}
hist(airData$Eating.and.Drinking.at.Airport)
```
#histogram of day of month: evenly spread out for the most part
```{r}
hist(airData$Day.of.Month)
```



#histogram of departure hours: people like their morning and afternoon flights
```{r}
hist(airData$Scheduled.Departure.Hour)
```
#histogram of departure delay: usually no delay :)
```{r}
hist(airData$Departure.Delay.in.Minutes)
```
#histogram of flight distance: usually about 2000 miles out, but there are quite a few short distance flights 0-1000 miles 
```{r}
hist(airData$Flight.Distance)
```
#histogram of likelihood to recommend: people either hated their airline or loved it
```{r}
hist(airData$Likelihood.to.recommend)
```
#table shows that most people travel economy, and usually redeem their mileage tickets there. even ish split between buisness travel and personal travel in economy, but more people travel buisness for buissness related travel, and there are more females in eco plus
```{r}
table(airData$Gender,airData$Type.of.Travel,airData$Class)
```
#boxplots of the likelihood to recommend grouped on gender. females are more likely to give a lower rating of their flight. 
```{r}
boxplot(Likelihood.to.recommend ~ Gender,airData)

```

#boxplots of the likelihood to recommend grouped on type of travel. buisness travel usually rates their flight highly. personal travelers rate their flight very poorly. mileage ticket people also rate their flight somewhat highly.
```{r}
boxplot(Likelihood.to.recommend ~ Type.of.Travel,airData)

```


#elim missing data
```{r}
airData <- na.omit(airData)

```

#mapping time
```{r}
library(ggplot2)
library(ggmap)
usmap <- get_stamenmap(bbox=c(left=-167.50, bottom=7.45, right=-50.19, top=71.58), 
                       zoom=3, maptype = "toner")
ggmap(usmap) + geom_point(data=airData, aes(x=dlong, y=dlat, 
                                                       color=Likelihood.to.recommend))

```
```{r}
dfDetract <- airData[airData$Likelihood.to.recommend < 7,]
dfPromote <- airData[airData$Likelihood.to.recommend >= 7,]

```


```{r}
usmap <- get_stamenmap(bbox=c(left=-167.50, bottom=7.45, right=-50.19, top=71.58), 
                       zoom=3, maptype = "toner")
ggmap(usmap) + geom_point(data=dfDetract, aes(x=dlong, y=dlat, 
                                                       color=Likelihood.to.recommend))

```
#both maps seem to include similar cities, though los angeles is interesting as here it is rated 9-10 and in the above map it is rated 3-4.
```{r}
usmap <- get_stamenmap(bbox=c(left=-167.50, bottom=7.45, right=-50.19, top=71.58), 
                       zoom=3, maptype = "toner")
ggmap(usmap) + geom_point(data=dfPromote, aes(x=dlong, y=dlat, 
                                                       color=Likelihood.to.recommend))

```

#southeastsucks
```{r}
library(quanteda.textplots)
library(quanteda)
dfDetractC <- dfDetract$freeText
corpus(dfDetractC)
dfDetractC <- dfm(dfDetractC, remove_punct=TRUE,
                                  remove=stopwords("english"), )

textplot_wordcloud(dfDetractC,)
```
```{r}
dfPromoteC <- dfPromote$freeText
corpus(dfPromoteC)
dfPromoteC <- dfm(dfPromoteC, remove_punct=TRUE,
                                  remove=stopwords("english"), )

textplot_wordcloud(dfPromoteC,)
```
#it appears that just traveling for personal reasons is a detractor.... and a delay on top of it is of course a detractor. 
```{r}
library(arules)
library(arulesViz)
airCat <- data.frame(gender=as.factor(airData$Gender),
                     type=as.factor(airData$Type.of.Travel),
                     old=(airData$Age>median(airData$Age)),
                     delay=(airData$Departure.Delay.in.Minutes>15),
                     detractor=(airData$Likelihood.to.recommend<7))
rules <- apriori(airCat)
inspect(rules)
```
# we can see that the reason for which you travel has an extreme effect on your likelihood to recommend. departure delay also has a very high significance value, which makes sense. our r squared value is 0.4. not high, but since we are dealing with humans, it makes sense
```{r}
sum(is.na(airData$Gender))
#time to do some data munging
airData$Gender[0]
for(i in 1:250){
  if(airData$Gender[i] == "Female"){
    airData$GenderN[i] <- 1  
  }
  if(airData$Gender[i] == "Male"){
    airData$GenderN[i] <- 0
  }
}
i <-1
for(i in 1:250){
  if(airData$Type.of.Travel[i] == "Business travel"){
    airData$Type.of.Travel[i]
    airData$TravelN[i] <- 1  
  }
  if(airData$Type.of.Travel[i] == "Personal Travel"){
    airData$TravelN[i] <- 0
  }
  if(airData$Type.of.Travel[i] == "Mileage tickets"){
    airData$TravelN[i] <- 2
  }
}

lmOut <- lm(Likelihood.to.recommend ~ Age + GenderN + TravelN + Flight.Distance +  Departure.Delay.in.Minutes, airData)
summary(lmOut)

```
#Based on the wordcloud graphics, we can clearly see that Southwest Airlines is a major concern as a major quality issue. It is quite unpredictable, especially when people expect more out of a major airline. Some issues include luggage delays, flight delays, and poor service while on the flight. To alleviate some of these concerns, we should work on improving departure delay the most, as it has the greatest effect on our recommendations rate. As we look at our linear model, departure delay has a significant effect on our likelihood for recommendations. It's significance value is 0.00198, which is well below the 0.05 recommended for statistical significance. Furthermore, we should place a bigger interest on our personal travelers, as most of them seem to have a negative experience. As we see in the boxplot split into groups based on travel reasons, we can tell that the box labeled Personal Travel has a much lower range of scores than the box marked Buisness travel. Furthermore, our association rules indicate that simply traveling for personal reasons is a detractor to their experience. Clearly, something is wrong. 
